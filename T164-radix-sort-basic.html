<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Radix Sort å¯è§†åŒ– - åŠ›æ‰£ T164 æœ€å¤§é—´è·</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    .input-group {
      margin-bottom: 12px;
    }
    .array-box, .bucket {
      display: flex;
      margin: 10px 0;
      justify-content: center;
      flex-wrap: wrap;
    }
    .item {
      width: 40px;
      height: 40px;
      margin: 4px;
      background-color: #4caf50;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      font-weight: bold;
    }
    .bucket-container {
      display: flex;
      justify-content: space-between;
    }
    .bucket-column {
      width: 60px;
      text-align: center;
    }
    .bucket-column .bucket {
      border: 1px solid #ccc;
      padding: 5px;
      min-height: 50px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    #log {
      background-color: #000;
      color: #0f0;
      padding: 10px;
      height: 180px;
      overflow-y: auto;
      white-space: pre-line;
      font-family: monospace;
    }
    .controls {
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <h2>ğŸ§® åŸºæ•°æ’åºå¯è§†åŒ– - åŠ›æ‰£ T164 æœ€å¤§é—´è·</h2>

  <div class="input-group">
    <label>è¾“å…¥æ•°ç»„ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š</label>
    <input id="inputArray" type="text" value="170,45,75,90,802,24,2,66" size="50">
  </div>

  <div class="input-group">
    <label>åŠ¨ç”»é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
    <input id="delay" type="number" value="1000" min="100">
  </div>

  <button onclick="startVisualization()">â–¶ï¸ å¼€å§‹å¯è§†åŒ–</button>
  <a href="index.html" style="margin-left:20px;">è¿”å›é¦–é¡µ</a>

  <h3>æ•°ç»„çŠ¶æ€</h3>
  <div id="array" class="array-box"></div>

  <h3>æ¯ä½çš„æ¡¶ï¼ˆ0~9ï¼‰</h3>
  <div class="bucket-container" id="buckets">
    <!-- 10ä¸ªæ¡¶ -->
    <!-- æ¯ä¸ªæ¡¶æ˜¯ .bucket-column ä¸‹çš„ .bucket -->
  </div>

  <h3>æ—¥å¿—è¾“å‡º</h3>
  <div id="log"></div>

  <script>
    const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

    function log(msg) {
      const logEl = document.getElementById("log");
      logEl.textContent += msg + "\n";
      logEl.scrollTop = logEl.scrollHeight;
    }

    function renderArray(arr) {
      const arrayEl = document.getElementById("array");
      arrayEl.innerHTML = "";
      arr.forEach(num => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerText = num;
        arrayEl.appendChild(div);
      });
    }

    function clearBuckets() {
      for (let i = 0; i < 10; i++) {
        document.getElementById(`bucket-${i}`).innerHTML = "";
      }
    }

    function renderBuckets(bucketQueues) {
      clearBuckets();
      for (let i = 0; i < 10; i++) {
        const bucket = bucketQueues[i];
        const container = document.getElementById(`bucket-${i}`);
        bucket.forEach(num => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerText = num;
          container.appendChild(div);
        });
      }
    }

    async function startVisualization() {
      const input = document.getElementById("inputArray").value.trim();
      const delay = parseInt(document.getElementById("delay").value) || 1000;
      const arr = input.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));

      if (arr.length < 2) {
        alert("è¯·è¾“å…¥è‡³å°‘ä¸¤ä¸ªæ•°å­—");
        return;
      }

      document.getElementById("log").textContent = "";
      log("å¼€å§‹åŸºæ•°æ’åº...");

      renderArray(arr);
      const max = Math.max(...arr);
      let exp = 1;

      while (Math.floor(max / exp) > 0) {
        log(`\nğŸ“ å½“å‰ä½æ•°ï¼ˆexpï¼‰: ${exp}`);
        const buckets = Array.from({ length: 10 }, () => []);

        // å…¥æ¡¶
        for (let num of arr) {
          const digit = Math.floor(num / exp) % 10;
          buckets[digit].push(num);
          log(`å°† ${num} æ”¾å…¥æ¡¶ ${digit}`);
        }

        renderBuckets(buckets);
        await sleep(delay);

        // å‡ºæ¡¶
        let idx = 0;
        for (let i = 0; i < 10; i++) {
          while (buckets[i].length > 0) {
            const num = buckets[i].shift();
            arr[idx++] = num;
            log(`ä»æ¡¶ ${i} å–å‡º ${num}`);
            renderArray(arr);
            renderBuckets(buckets);
            await sleep(100);
          }
        }

        exp *= 10;
      }

      log(`\nâœ… æ’åºå®Œæˆ: ${arr.join(', ')}`);
      // è®¡ç®—æœ€å¤§é—´è·
      let maxGap = 0;
      for (let i = 1; i < arr.length; i++) {
        const gap = arr[i] - arr[i - 1];
        log(`é—´è·: ${arr[i]} - ${arr[i - 1]} = ${gap}`);
        maxGap = Math.max(maxGap, gap);
      }

      log(`\nğŸ”¥ æœ€å¤§é—´è·ä¸º: ${maxGap}`);
    }

    // åˆå§‹åŒ–æ¡¶ UI
    window.onload = () => {
      const container = document.getElementById("buckets");
      for (let i = 0; i < 10; i++) {
        const col = document.createElement("div");
        col.className = "bucket-column";
        col.innerHTML = `<strong>${i}</strong><div class="bucket" id="bucket-${i}"></div>`;
        container.appendChild(col);
      }
    }
  </script>
</body>
</html>
