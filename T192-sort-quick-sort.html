<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>T192 å¿«é€Ÿæ’åºå¯è§†åŒ–</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      text-align: center;
    }
    #array-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 300px;
      margin-bottom: 5px;
      gap: 5px;
    }
    .bar {
      width: 30px;
      background-color: steelblue;
      color: white;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      font-size: 12px;
      transition: background-color 0.3s ease;
      user-select: none;
      border-radius: 3px;
    }
    .pivot {
      background-color: darkorange !important;
    }
    .left-boundary {
      border-bottom: 3px solid limegreen;
    }
    .right-boundary {
      border-bottom: 3px solid crimson;
    }
    .current-compare {
      background-color: #ff6666 !important;
    }
    .partition-index {
      background-color: #3399ff !important;
    }
    #index-labels, #info-labels {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-bottom: 8px;
      user-select: none;
    }
    #index-labels span, #info-labels span {
      width: 30px;
      text-align: center;
      font-size: 12px;
      color: #333;
    }
    #log {
      background-color: black;
      color: limegreen;
      padding: 10px;
      font-family: monospace;
      text-align: left;
      max-height: 250px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    input[type=text], input[type=number] {
      padding: 5px;
      font-size: 14px;
      width: 320px;
      max-width: 100%;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      margin: 0 5px 15px;
      cursor: pointer;
    }
    footer {
      margin-top: 40px;
    }
    a {
      color: #0066cc;
      text-decoration: none;
      font-weight: bold;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>ğŸ” T192 å¿«é€Ÿæ’åºç®—æ³•å¯è§†åŒ–</h2>
  <div>
    <label>è¯·è¾“å…¥æ•°ç»„ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ï¼š</label><br />
    <input id="arrayInput" type="text" value="9,8,7,6,5,4,3,2,1" />
  </div>
  <div>
    <label>åŠ¨ç”»æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ï¼š</label>
    <input id="delayInput" type="number" value="1000" min="100" max="5000" />
  </div>
  <div>
    <button onclick="startSort()">å¼€å§‹æ’åº</button>
    <button onclick="resetArray()">é‡ç½®æ•°ç»„</button>
  </div>

  <div id="array-container"></div>
  <div id="index-labels"></div>
  <div id="info-labels"></div>

  <h3>ğŸ“œ æ—¥å¿—è¾“å‡º</h3>
  <div id="log"></div>

  <footer>
    <a href="index.html">ğŸ”™ è¿”å›é¦–é¡µ</a>
  </footer>

  <script>
    const container = document.getElementById("array-container");
    const indexLabels = document.getElementById("index-labels");
    const infoLabels = document.getElementById("info-labels");
    const logEl = document.getElementById("log");
    const arrayInput = document.getElementById("arrayInput");
    const delayInput = document.getElementById("delayInput");

    let nums = [];
    let delay = 1000;
    let sorting = false;

    // å»¶è¿Ÿå·¥å…·å‡½æ•°
    function sleep(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }

    // æ¸²æŸ“æ•°ç»„æ¡å½¢å›¾
    function renderArray(arr, highlight = {}) {
      container.innerHTML = "";
      indexLabels.innerHTML = "";
      infoLabels.innerHTML = "";

      if (arr.length === 0) return;

      const maxVal = Math.max(...arr);

      arr.forEach((val, idx) => {
        const bar = document.createElement("div");
        bar.className = "bar";
        bar.style.height = ((val / maxVal) * 100).toFixed(2) + "%";
        bar.textContent = val;

        if (highlight.pivot === idx) bar.classList.add("pivot");
        if (highlight.left === idx) bar.classList.add("left-boundary");
        if (highlight.right === idx) bar.classList.add("right-boundary");
        if (highlight.current === idx) bar.classList.add("current-compare");
        if (highlight.partition === idx) bar.classList.add("partition-index");

        container.appendChild(bar);

        // ä¸‹æ ‡
        const idxSpan = document.createElement("span");
        idxSpan.textContent = idx;
        indexLabels.appendChild(idxSpan);

        // è¾…åŠ©ä¿¡æ¯ï¼šæ˜¾ç¤ºå½“å‰ left, right, pivotï¼Œç©ºç™½åˆ™ä¸æ˜¾ç¤º
        const infoSpan = document.createElement("span");
        let label = "";
        if (highlight.left === idx) label = "L";
        else if (highlight.right === idx) label = "R";
        else if (highlight.pivot === idx) label = "P";
        else if (highlight.partition === idx) label = "X";
        infoSpan.textContent = label;
        infoLabels.appendChild(infoSpan);
      });
    }

    // æ—¥å¿—æ‰“å°
    function log(msg) {
      logEl.textContent += msg + "\n";
      logEl.scrollTop = logEl.scrollHeight;
    }

    // äº¤æ¢æ•°ç»„å…ƒç´ 
    function swap(arr, i, j) {
      if (i !== j) {
        const tmp = arr[i];
        arr[i] = arr[j];
        arr[j] = tmp;
      }
    }

    // partition å‡½æ•°ï¼Œè¿”å›åˆ†å‰²ç‚¹ç´¢å¼•ï¼Œé…åˆåŠ¨ç”»
    async function partition(arr, left, right) {
      const pivotVal = arr[right];
      let px = left;

      log(`partition å¼€å§‹ï¼Œleft=${left}, right=${right}, pivotVal=arr[${right}]=${pivotVal}`);
      renderArray(arr, { left, right, pivot: right, partition: px });
      await sleep(delay);

      for (let i = left; i < right; i++) {
        renderArray(arr, { left, right, pivot: right, current: i, partition: px });
        log(`æ¯”è¾ƒ arr[${i}]=${arr[i]} å’Œ pivotVal=${pivotVal}`);
        await sleep(delay);

        if (arr[i] < pivotVal) {
          log(`arr[${i}] < pivotValï¼Œäº¤æ¢ arr[${i}] å’Œ arr[${px}]`);
          swap(arr, px, i);
          px++;
          renderArray(arr, { left, right, pivot: right, partition: px });
          await sleep(delay);
        }
      }

      log(`å¾ªç¯ç»“æŸï¼Œäº¤æ¢ pivot å’Œ arr[${px}]`);
      swap(arr, px, right);
      renderArray(arr, { left, right, pivot: px, partition: px });
      await sleep(delay);

      log(`partition è¿”å›åˆ†å‰²ç‚¹ index=${px}\n`);
      return px;
    }

    // å¿«é€Ÿæ’åºé€’å½’å‡½æ•°ï¼ŒåŠ¨ç”»å¼‚æ­¥å®ç°
    async function quickSort(arr, left, right) {
      if (left >= right) {
        if (left === right) {
          log(`å•å…ƒç´ åŒºé—´ left=right=${left}, æ— éœ€æ’åº`);
          renderArray(arr, { left, right });
          await sleep(delay);
        }
        return;
      }

      log(`quickSort é€’å½’è°ƒç”¨ï¼šleft=${left}, right=${right}`);
      renderArray(arr, { left, right });
      await sleep(delay);

      const partIx = await partition(arr, left, right);

      await quickSort(arr, left, partIx - 1);
      await quickSort(arr, partIx + 1, right);
    }

    // ä¸»å…¥å£ï¼Œå¯åŠ¨æ’åº
    async function startSort() {
      if (sorting) return;
      sorting = true;
      logEl.textContent = "";

      // è§£æè¾“å…¥æ•°ç»„
      const inputStr = arrayInput.value.trim();
      nums = inputStr.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));
      if (nums.length === 0) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°ç»„ï¼");
        sorting = false;
        return;
      }

      delay = parseInt(delayInput.value);
      if (isNaN(delay) || delay < 100) delay = 1000;

      renderArray(nums);
      log("å¼€å§‹å¿«é€Ÿæ’åº...\n");
      await quickSort(nums, 0, nums.length - 1);
      log("\næ’åºå®Œæˆï¼");

      sorting = false;
    }

    // é‡ç½®æ•°ç»„æ˜¾ç¤ºä¸ºè¾“å…¥æ¡†å†…å®¹
    function resetArray() {
      if (sorting) return;
      const inputStr = arrayInput.value.trim();
      nums = inputStr.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));
      renderArray(nums);
      logEl.textContent = "";
    }

    // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“é»˜è®¤æ•°ç»„
    window.onload = () => {
      resetArray();
    };
  </script>
</body>
</html>
