<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>T192 æ’å…¥æ’åºå¯è§†åŒ–</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #sortView, #searchView {
      display: flex;
      align-items: flex-end;
      height: 200px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      padding: 10px;
      position: relative;
    }

    .bar {
      width: 30px;
      margin: 0 5px;
      background-color: steelblue;
      text-align: center;
      color: white;
      transition: all 0.3s ease;
      position: relative;
    }

    .highlight {
      background-color: orange !important;
    }

    .insert {
      background-color: green !important;
    }

    .pointer {
      position: absolute;
      bottom: -20px;
      width: 100%;
      text-align: center;
      font-weight: bold;
      color: red;
    }

    #log {
      background-color: black;
      color: white;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 10px;
    }

    input, button {
      margin: 5px;
    }

    a {
      display: inline-block;
      margin-top: 20px;
    }

    h3 {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

<h2>T192 æ’å…¥æ’åºï¼ˆå¸¦äºŒåˆ†æŸ¥æ‰¾ï¼‰å¯è§†åŒ–</h2>

<label>è¾“å…¥æ•°ç»„ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
<input type="text" id="inputArray" value="5,3,1,4,6,2,7" />
<br>
<label>åŠ¨ç”»é—´éš”ï¼ˆmsï¼‰:</label>
<input type="number" id="interval" value="1000" />
<button onclick="startVisualization()">ğŸ” å¼€å§‹å¯è§†åŒ–</button>

<h3>æ’åºç›´æ–¹å›¾</h3>
<div id="sortView"></div>

<h3>å½“å‰äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹</h3>
<div id="searchView"></div>

<h3>æ—¥å¿—è¾“å‡º</h3>
<div id="log"></div>

<a href="index.html">ğŸ”™ è¿”å›é¦–é¡µ</a>

<script>
  function log(msg) {
    const logDiv = document.getElementById("log");
    logDiv.innerText += msg + "\n";
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  function renderSortView(arr, highlight = [], insertIdx = -1) {
    const container = document.getElementById("sortView");
    container.innerHTML = "";
    const max = Math.max(...arr);
    arr.forEach((val, i) => {
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.height = `${(val / max) * 100 + 50}px`;
      bar.innerText = val;
      if (highlight.includes(i)) bar.classList.add("highlight");
      if (i === insertIdx) bar.classList.add("insert");
      container.appendChild(bar);
    });
  }

  function renderSearchView(arr, left, right, mid) {
    const container = document.getElementById("searchView");
    container.innerHTML = "";
    arr.forEach((val, i) => {
      const bar = document.createElement("div");
      bar.className = "bar";
      bar.style.height = "40px";
      bar.style.backgroundColor = "#666";
      bar.innerText = val;

      if (i === mid) bar.classList.add("highlight");
      else if (i === left || i === right) bar.classList.add("insert");

      // æ·»åŠ  L/M/R æŒ‡é’ˆ
      const pointer = document.createElement("div");
      pointer.className = "pointer";
      if (i === left) pointer.innerText = "L";
      if (i === right) pointer.innerText += "R";
      if (i === mid) pointer.innerText += "M";
      bar.appendChild(pointer);

      container.appendChild(bar);
    });
  }

  async function binarySearchVisual(nums, left, right, target, delay) {
    log(`ğŸ” äºŒåˆ†æŸ¥æ‰¾ï¼štarget=${target}ï¼Œåˆå§‹åŒºé—´=[${left}, ${right}]`);
    while (left <= right) {
      const mid = left + Math.floor((right - left) / 2);
      log(`  â†’ mid=${mid}, nums[mid]=${nums[mid]}`);
      renderSearchView(nums, left, right, mid);
      await sleep(delay);

      if (nums[mid] < target) {
        left = mid + 1;
      } else {
        right = mid - 1;
      }
    }
    log(`âœ… æ’å…¥ä½ç½®ï¼š${left}\n`);
    return left;
  }

  async function insertionSortVisual(arr, delay) {
    renderSortView(arr);
    for (let i = 1; i < arr.length; i++) {
      const curNum = arr[i];
      log(`=== ç¬¬ ${i} æ­¥ï¼šå½“å‰æ•° = ${curNum} ===`);
      const insertPos = await binarySearchVisual(arr.slice(0, i), 0, i - 1, curNum, delay);

      // å…ƒç´ å³ç§»
      for (let j = i; j > insertPos; j--) {
        arr[j] = arr[j - 1];
      }
      arr[insertPos] = curNum;

      log(`ğŸ’¡ æ’å…¥ ${curNum} åˆ°ä½ç½® ${insertPos}`);
      renderSortView(arr, [], insertPos);
      await sleep(delay);
    }

    renderSearchView([], -1, -1, -1); // æ¸…ç©ºäºŒåˆ†æŸ¥æ‰¾åŒºåŸŸ
    log("\nğŸ‰ æ’åºå®Œæˆï¼");
    renderSortView(arr);
  }

  function startVisualization() {
    document.getElementById("log").innerText = "";
    const input = document.getElementById("inputArray").value;
    const arr = input.split(",").map(x => parseInt(x.trim()));
    const delay = parseInt(document.getElementById("interval").value);
    insertionSortVisual([...arr], delay);
  }
</script>

</body>
</html>
